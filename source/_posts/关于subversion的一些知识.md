title: 关于subversion的一些知识
author: LanGaoBai
author_id: langaobai
language: zh-CN
tags:
  - SVN
  - 版本管理
  - 程序员必修三部曲
categories:
  - 版本管理
  - 书籍
date: 2018-05-31 13:53:00
---

前面，有一篇文章专门提到了，**重新认识版本管理**，并提到的**版本管理的重要性**；

作为一名程序员，少不了对自己的要求越来越严格，但是如何严谨的规范和约束自己，包括自己所在的团队呢？

在之前，我的一位大佬，跟我们说了这么一段话：

> 做事情呢，一定要讲究 **道**，**法**，**术**，**器**；

前面的各有各的说法，我们着重讲解一下，这个**器**；

这里我将聚焦在更详细的地方，当然是有出处的——出自《版本管理之道-使用subversion》；

感兴趣的朋友不妨去下载看看，或者购买纸质的书籍，也不算厚，相信即使你是初学者，一个星期的时间也能读完本书并掌握基础的技能；

这里算是我的学习笔记，不完全抄自本书，会结合部分自己的见解加以深入思考；

## SVN的基础内容

### 版本

版本从何而来呢？每一次的增、删、改都会在SVN（subversion的简写，后面均称为SVN）中标记一个新版本；

用过CVS（*Concurrent Versions System 并行版本系统的简称*），就会知道这里有点区别；

**CVS**记录的是**单个文件的版本**,而**SVN**记录的是整个**项目仓库的版本**;

### 标签

很多时候，我们都无法记住r677到底用于干什么的？但我们准能记住V3.0这种，第三正式版本；

版本控制系统让你可以给**某一时刻的一组文件、或者一些目录或者整个项目分配一个名字**。

如果你们的项目开发到达了一定程度，你标记为 **v2.0 beta**，你以后就能用这个标签签出他们；

> 标签是一种很好的跟踪项目代码开发过程中发生重要事件的方式；

### 分支

当我们一个项目组对同一份源代码添加，修改内容，并进行签入和签出的时候，大家都共享这份源代码；

我们将这份居于主要地位的源代码称为**主干**；

![主干](\img\articlePicture\svnTunk.gif)

那么**分支**又是一个怎样的需求呢？为什么会产生分支这种情况；

我们可以把主干和分支想象成你所在的时空和另外一个由你本身所做的出改变而产生的另外一个时空；

通俗一点说，当我们开发到一定过程的时候， 我们需要发布V2.0版本了，这个时候，上线是需要稳定，和减少bug的；

你不可能说拿着一堆在开发的东西就给客户，至少你需要粉饰一下，而你能怎么做呢？

1. 让大家都停下手中的活，向着发布的方向进行改动？
2. 拷贝到其他地方，重新开始，那怎么比对项目最开始的地方，进行跟踪和修正呢？（别跟我说重开一个服务器什么的）

这个时候，就产生了这样的需求“分支”；

> 老实说，我还是觉得这样的解释，弱化了分支的功能，有点强行解释的味道，后面我加深理解，再做扩展；

分支产生以后，主开发团队可以继续对着之前的主线干活；

而发布团队，则对分支进行修正，比对而又能对过去的问题进行持续的跟踪；

这里作者还说了一个问题，有人被分支搞到头大，是因为过度使用分支，而这样最后会发现，你在合并的时候，痛苦异常；

### 合并

在这里想到了继续用**盗梦空间**的话题比喻最为合适；

当我们进入第三层梦的时候，小李子终于修正了富二代费舍的思想，这个时候，需要就需要回归主干，进行**合并**了；

当然在主干中的行为，修正一些bug，也可以及时的合并到分支上来，也可以想像一下小李子的第二层梦对他第三层梦的影响，在合并的影响下传递到了第三层梦中了。

### 加锁

学过编程的都知道，加锁，在编程中加锁以后的线程，只能是单个线程访问，不能是多线程同时访问；

顾明思议，当两个人都要操作同一个源文件的时候，就像我要进房间，而又不允许别人进这个房间，那么我就选择**加锁处理**；

#### 严格加锁

被加锁的文件一开始都是**只读**状态，要编辑和修改必须征询项目仓库的同意，在没有其他人编辑同一个文件的时候，项目仓库就会授权给你，其他人这个时候要编辑，仓库就会拒绝；

#### 乐观加锁

也就是当你进行签入的时候，项目仓库会先行更新你的本地文件，再让你进行签入；

但这个时候，版本控制系统不会简单的以项目仓库中最新版本的文件去覆盖你辛苦改过的文件，而是**尝试着去合并项目仓库中所有的改动和你的改动**；

一般而言严格加锁在使用过程中会出现很多问题，例如：一个人必须要等其他人编辑结束并签入之后才能继续他的工作；

因此用得更多的反而是乐观加锁处理；

## SVN备份[^一关开发室]

### 1. 导出

1.进入svn安装路径bin文件夹下，使用 cd 命令

在windows下，<kbd>win</kbd><kbd>+</kbd><kbd>R</kbd> 键入 `cmd` 回车 打开命令窗口cmd，进入下列目录（`svn服务器安装目录bin`）： 

`"c:\Program Files\VisualSVN Server\bin\"`

![svn目录](\img\articlePicture\svnbinToc.png)

2.备份/导出（svnadmin dump C:\Repositories\需导出库 > E:\*\*文件夹\full.svn.bak）

输入下列命令并执行：

`svnadmin dump C:\Repositories\Hash加密（MD5、Sha1） > E:\svnbak\full.svn.bak`

 ![svnadmindump](\img\articlePicture\svnadmindump.gif)

3、full.svn.bak为备份文件。将其文件拷贝到目标机器,或是存储备份。

### 2. 导入/还原：

1、在目标机器创建仓库：

`svnadmin create D:/repositories/TestProject  (可右键**管理Server**新建)`

并注意检查是否需要修改文件夹权限 

2、执行命令svnadminload:

`svnadmin load D:/repositories/TestProject **<** E:\svnbak\full.svn.bak`

图解：

 ![svnadmindumpload](\img\articlePicture\svnadmindumpload.gif)

注释：该种方式适用于重装服务器、移动代码库 使用。

问题：

1.svn不知道这样的主机

重做服务器后，计算机名称肯定是不一样的。我们之前的项目还是老计算机名字，只要**更改一下计算机名字**即可实现。或者更改 

![svnRname](\img\articlePicture\svnRname.gif)

### 3. 目录式导入导出

找到`VisualSvn Server`中的**操作**点击**Stroage**查找到svn管理目录，直接进行拷贝备份；

移植到新目录也是这样，这个方法简单粗暴了点，而且也并非官方支持，*谨慎使用吧*；


[^一关开发室]: https://www.cnblogs.com/blogs2014/p/5039213.html